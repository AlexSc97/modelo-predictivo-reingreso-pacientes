<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo Predictivo para pacientes con Readmisión temprana</title>
    <link rel="stylesheet" href="/static/style.css?v=14">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body>
    <div class="background-orb orb-1"></div>
    <div class="background-orb orb-2"></div>
    <div class="grid-overlay"></div>

    <div class="app-container">
        <!-- Barra de navegacion -->
        <aside class="sidebar">
            <div class="brand">
                <span class="brand-text">Modelo Predictivo de Readmisión Temprana</span>
            </div>

            <nav class="stepper">
                <div class="step active" data-step="1">
                    <div class="step-icon"><span class="material-icons-round">history</span></div>
                    <div class="step-content">
                        <span class="step-title">Historial</span>
                        <span class="step-desc">Estancia y visitas</span>
                    </div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-icon"><span class="material-icons-round">person</span></div>
                    <div class="step-content">
                        <span class="step-title">Paciente</span>
                        <span class="step-desc">Datos demográficos</span>
                    </div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-icon"><span class="material-icons-round">monitor_heart</span></div>
                    <div class="step-content">
                        <span class="step-title">Diagnóstico</span>
                        <span class="step-desc">Cuadro clínico</span>
                    </div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-icon"><span class="material-icons-round">medication</span></div>
                    <div class="step-content">
                        <span class="step-title">Tratamiento</span>
                        <span class="step-desc">Medicación actual</span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="model-status">
                    <span class="status-dot"></span>
                    Modelo entrenado con XGBoost
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-bar">
                <h1>Evaluación de Riesgo de Readmisión</h1>
            </header>

            <div class="content-wrapper">
                <!-- Form Container -->
                <div class="glass-panel form-panel" id="formPanel">
                    <form id="predictionForm" class="wizard-form">

                        <!-- Step 1: Historial -->
                        <div class="wizard-step active" id="step1">
                            <h2 class="step-header">Historial Hospitalario</h2>
                            <div class="input-grid">
                                <div class="input-group" id="group_number_inpatient">
                                    <label>Visitas Hospitalarias Previas</label>
                                    <div class="range-wrapper">
                                        <input type="range" id="number_inpatient" name="number_inpatient" min="0"
                                            max="20" value="0" oninput="this.nextElementSibling.value = this.value">
                                        <output>0</output>
                                    </div>
                                </div>
                                <div class="input-group" id="group_number_emergency">
                                    <label>Visitas de Emergencia</label>
                                    <div class="range-wrapper">
                                        <input type="range" id="number_emergency" name="number_emergency" min="0"
                                            max="20" value="0" oninput="this.nextElementSibling.value = this.value">
                                        <output>0</output>
                                    </div>
                                </div>
                                <div class="input-group" id="group_time_in_hospital">
                                    <label>Días en Hospital</label>
                                    <div class="range-wrapper">
                                        <input type="range" id="time_in_hospital" name="time_in_hospital" min="1"
                                            max="14" value="1" oninput="this.nextElementSibling.value = this.value">
                                        <output>1</output>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Demografía -->
                        <div class="wizard-step" id="step2">
                            <h2 class="step-header">Datos del Paciente</h2>
                            <div class="input-grid">
                                <div class="input-group" id="group_age">
                                    <label>Edad Aproximada</label>
                                    <select id="age" name="age" class="custom-select">
                                        <option value="5">0-10 años</option>
                                        <option value="15">10-20 años</option>
                                        <option value="25">20-30 años</option>
                                        <option value="35">30-40 años</option>
                                        <option value="45">40-50 años</option>
                                        <option value="55">50-60 años</option>
                                        <option value="65">60-70 años</option>
                                        <option value="75">70-80 años</option>
                                        <option value="85">80-90 años</option>
                                        <option value="95">90+ años</option>
                                    </select>
                                </div>
                                <div class="input-group" id="group_discharge_segment">
                                    <label>Tipo de Alta</label>
                                    <div class="radio-cards">
                                        <label class="radio-card">
                                            <input type="radio" name="discharge_segment" id="discharge_segment"
                                                value="Discharged to home" checked>
                                            <div class="card-content">
                                                <span class="material-icons-round">home</span>
                                                <span>Domicilio</span>
                                            </div>
                                        </label>
                                        <label class="radio-card">
                                            <input type="radio" name="discharge_segment" value="Otherwise">
                                            <div class="card-content">
                                                <span class="material-icons-round">local_hospital</span>
                                                <span>Otro / Traslado</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="input-group" id="group_number_diagnoses">
                                    <label>Número de Diagnósticos</label>
                                    <div class="number-control">
                                        <button type="button"
                                            onclick="document.getElementById('number_diagnoses').stepDown()">-</button>
                                        <input type="number" id="number_diagnoses" name="number_diagnoses" min="1"
                                            max="16" value="1" readonly>
                                        <button type="button"
                                            onclick="document.getElementById('number_diagnoses').stepUp()">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Diagnósticos -->
                        <div class="wizard-step" id="step3">
                            <h2 class="step-header">Cuadro Clínico</h2>
                            <div class="input-grid">
                                <div class="input-group" id="group_diag_1_group">
                                    <label>Diagnóstico Primario</label>
                                    <select id="diag_1_group" name="diag_1_group" class="custom-select">
                                        <option value="Diabetes">Diabetes</option>
                                        <option value="Circulatory">Circulatorio</option>
                                        <option value="Respiratory">Respiratorio</option>
                                        <option value="Digestive">Digestivo</option>
                                        <option value="Injury">Lesión</option>
                                        <option value="Musculoskeletal">Musculoesquelético</option>
                                        <option value="Genitourinary">Genitourinario</option>
                                        <option value="Neoplasms">Neoplasias</option>
                                        <option value="Other">Otro</option>
                                    </select>
                                </div>
                                <div class="input-group" id="group_diag_2_group">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <label style="margin-bottom: 0;">Diagnóstico Secundario</label>
                                        <div class="toggle-switch small-toggle">
                                            <input type="checkbox" id="no_diag_2_checkbox">
                                            <label for="no_diag_2_checkbox"></label>
                                            <span class="toggle-label"
                                                style="font-size: 0.85rem; color: var(--text-muted);">Ninguno</span>
                                        </div>
                                    </div>
                                    <div class="select-wrapper-animated">
                                        <select id="diag_2_group" name="diag_2_group" class="custom-select">
                                            <option value="Diabetes">Diabetes</option>
                                            <option value="Circulatory">Circulatorio</option>
                                            <option value="Respiratory">Respiratorio</option>
                                            <option value="Digestive">Digestivo</option>
                                            <option value="Injury">Lesión</option>
                                            <option value="Musculoskeletal">Musculoesquelético</option>
                                            <option value="Genitourinary">Genitourinario</option>
                                            <option value="Neoplasms">Neoplasias</option>
                                            <option value="Other">Otro</option>
                                        </select>
                                        <div class="disabled-overlay">
                                            <span class="material-icons-round">block</span>
                                            <span>No Aplica</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Medicación -->
                        <div class="wizard-step" id="step4">
                            <h2 class="step-header">Medicación</h2>
                            <div class="input-grid">
                                <div class="input-group" id="group_diabetesMed">
                                    <label>Medicación Diabetes</label>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="diabetesMed_toggle">
                                        <label for="diabetesMed_toggle"></label>
                                        <span class="toggle-label">No / Sí</span>
                                    </div>
                                    <input type="hidden" id="diabetesMed" name="diabetesMed" value="No">
                                </div>
                                <div class="input-group" id="group_metformin">
                                    <label>Metformina</label>
                                    <select id="metformin" name="metformin" class="custom-select">
                                        <option value="No">No usa</option>
                                        <option value="Steady">Estable</option>
                                        <option value="Up">Aumentó Dosis</option>
                                        <option value="Down">Redujo Dosis</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="wizard-actions">
                            <button type="button" class="btn btn-text" id="prevBtn" disabled>Atrás</button>
                            <button type="button" class="btn btn-primary" id="nextBtn">Siguiente</button>
                            <button type="submit" class="btn btn-submit" id="submitBtn" style="display: none;">
                                <span>Analizar Riesgo</span>
                                <span class="material-icons-round">bolt</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Results Panel (Hidden by default) -->
                <div class="glass-panel results-panel" id="resultsPanel" style="display: none;">
                    <div class="results-header">
                        <button class="btn-icon" id="backToForm"><span
                                class="material-icons-round">arrow_back</span></button>
                        <h2>Informe de Predicción</h2>
                    </div>

                    <div class="prediction-outcome-container">
                        <h1 id="predictionOutcome" class="prediction-outcome"></h1>
                    </div>

                    <div class="results-grid">
                        <!-- Top Row: Risk Gauge & Factors Chart -->
                        <div class="risk-card main-risk">
                            <div class="risk-circle-wrapper">
                                <svg class="risk-circle" viewBox="0 0 36 36">
                                    <path class="circle-bg"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle-fill" stroke-dasharray="0, 100"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <div class="risk-value">
                                    <span id="riskPercentage">0%</span>
                                    <span class="risk-label-text">Probabilidad</span>
                                </div>
                            </div>
                            <div class="risk-status" id="riskStatus">Calculando...</div>
                        </div>

                        <div class="analysis-card">
                            <h3><span class="material-icons-round">bar_chart</span> Análisis de Factores Clave</h3>
                            <div class="factors-chart-container">
                                <div class="factors-list" id="impactList">
                                    <!-- Injected via JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Bottom Row: Detailed Report -->
                        <div class="recommendation-card full-width-card">
                            <h3><span class="material-icons-round">analytics</span> Informe Detallado e Interpretación
                            </h3>
                            <div class="report-content">
                                <p id="recommendationText">El análisis detallado aparecerá aquí.</p>
                            </div>

                            <div class="action-area">
                                <button class="btn btn-reset" id="resetBtn">
                                    <span class="material-icons-round"
                                        style="font-size: 1rem; vertical-align: middle; margin-right: 5px;">refresh</span>
                                    Nueva Predicción
                                </button>
                            </div>
                        </div>

                        <!-- SHAP Visualization Card -->
                        <div class="shap-visualization-card full-width-card">
                            <h3><span class="material-icons-round">insights</span> Análisis SHAP Detallado</h3>
                            <p class="shap-description">
                                Este gráfico muestra cómo cada característica del paciente contribuye a la predicción
                                final.
                            </p>

                            <div class="shap-legend">
                                <div class="legend-item">
                                    <div class="legend-color color-red"></div>
                                    <span>Aumenta el Riesgo</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color color-blue"></div>
                                    <span>Disminuye el Riesgo</span>
                                </div>
                            </div>

                            <div class="shap-plot-container" id="shapPlotContainer">
                                <div class="loading-spinner">
                                    <span class="material-icons-round spin">sync</span>
                                    <p>Generando visualización SHAP...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/script.js?v=13"></script>
</body>

</html>